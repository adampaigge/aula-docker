sudo: required
services:
- docker
language: c
env:
  global:
  - secure: "AzUCvq/aPbDZ/kAx/YK/7ptUB7JzLFJm/+uMUY4qc3bfcH00bBH/AcpiPPrN9AePU0mAQI5/muFpuVlEl+zXpCKL6dDcm0SUpROjbmNmXuI+qVs2N6uEQFf66cIKEUWRYoh3EK/7tZMjpp2U3KhaE7h3mZOnox+CU6FBKtU1DdoNZyZX/tNA2o4WK8iHICvLeSvpR0dGiLdxN0yZisgKxuDJ7lp4RhLU1E6WJ23ciL225TiDg3cwmoBHhmpTs0jYhG9Sda9t7oFgFPUsn/uAhUe7qDuvxlCSu0GbJDmzagQbeIYeufW24G9nRsS1xaZpUhq8Rq9Phb9UryRITzZwu1BLPrfgH+ryvTATD/GEuWt5vDWf1ZfToB3/AB4LrkmlIB7O1NIaxdNVHF1C86Sdl5hzrfQ/hr8zaJy4FDFwsB3uMwdaR7UR/IctBBCulP5uSmjne6qqAfLodLbaG3B4fjGNzgUvtFlkJ0DHhPkg1Q4lQt+QTb19tjNuoQME4sCdAbKWHp0Cs+3B6qip4jD3V6KvxnCkP4g+TJGsNG4SF9nr/r6kQ02iYQz9nqdQr5M7jtdNG7v3MUsyfOdhRomW3Yew/qTbiblnxK0DlU1fz14KxC7T6wEcLoVBFQqBWFrZZaZt/tvMyb0EPW7ic19fmNaY3oDhVty6nWm9+4z3Y1c=" # DOCKER_EMAIL
  - secure: "T43omtzV4mqGFlQ9I5XX0TFEqkOQoN6E2U8vurnUaRPWW4PHyPWj7IEfbJP0g/+GmyhWIpNYnm6Wp022eEqctJ4FXrEFMWyYEkbqj8nHOS9oADbhGrXoL/h5KFW3i9uY6RqACRY/vM2hMkX+AX0Q1udlesqY5A2WmeIU7M0lmAm2UIEl4cRIK2qA+iEAzVdV/HPWW0U2CJ+4voWW4u9prMJpxfGht6txKnxlxBo043v53mFH3WRjbicJTT9cBNyUZRmTxEQbXwzcJakmaC+Y/hj79/pj7shThvDi6OT2WqpTsrF0Li/nEuROG+GOWj1ha+0OkjksrMx2GFyUGyKfEBcpDMOsPG55t4mhSsJN7HwUM3Pqi65f15ceJzDcFKpLUaxgAUOVJB+4Kk2GTQUEdIW5kCU3z90daE2dnaShZvXErzgc9hhrIEKWUkbzUJDS3Zfr4jYSJBLUyMwCPGsZUAF/CZUeEsQwIjQwsKlWV0WoPMiqSwhAGHoF/BhQije5+2uLJEDiFGb2tEi0f7REGgpd1zdlKUiNzxOhTId2F/rJ1IayCcyHdbCnLizkemkWZArv7djUQfk3pCHJ3BKLwpR0sqX2oez+TV0Pv0DKb5nvix5zayujGf7iC6b8jheBgs9Ne9IXF0Dwj6LGKMDC4cPqmOF2dPCPdP+joI0HmLw=" # DOCKER_USERNAME
  - secure: "Dpn/ts4F7Z3UeQNUUK6vkVmM5hrgatMb1BuDsBv7OkW5YhOnVuehL2dDFZRa0vPq5Crf2E8mpFzp8fxV2afX5FNhfcLLXDai969A1IXLH7gcww/uLg9zq+Ht7k+blgjdQX8xCiMgV+vRkiVul0t8lhx2MuWPhbUoGtjk72leCIX5t8wPVMOvbTb0HtOmGam/9VjCAq7uF6SHdsKHyAxMUnkQYfXp94HESFbvjiPAW2Jx79leDTKk08X3Uxyv+OnNNopFdu/tLfToXS2Jv4mPDWcxQke3owuy5VvMwOkVg2Jvo0HlBvT4F9OWN3D5581b1CIZFpQL8AzYElLqQMWtXIhENtr2R4pkOOD6VTdTq3ldCj24Dne6IGwGFI3BE+e1rkPrzu7eoVFvhMNNBgraXk1kL3zoezUwwEy9dksMh1xxTPukHq7bKaV9xxRSgHV68Il2fjob+j4BWKg2BuYC5IHPaH0i8QMFI3k89vj6iIIcUHkFhc7lf4G57PYuFGbkceX2HT3qBl+cFseyOS4ATUSqZitRR8cJmDuQA8ZfTQuLKjvHNFygK83MYv0L1iuq1dlsTQH8iqq99ggS6YblQOMSz/1ibJjLxCPJ6PFSVGZnne/NSjA6xb+a7Cbmh2SDR8gv2Rk8ByjFbtbR8d/nqCK0G3Zv/haZjHDOKYuldV8=" # DOCKER_PASS
  - COMMIT=${TRAVIS_COMMIT::8}
script:
  - echo "Building aula docker image..."
after_success:
  - git submodule init
  - git submodule update
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USERNAME -p $DOCKER_PASS
  - export REPO=fisx/aula
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker push $REPO
